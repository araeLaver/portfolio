<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Portfolio</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link href="/css/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a class="navbar-brand" href="/admin">ADMIN PANEL</a>
            <ul class="navbar-nav">
                <li><a href="/">사이트 보기</a></li>
                <li>
                    <form th:action="@{/logout}" method="post" style="display: inline;">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit" class="btn btn-link" style="padding: 0.5rem 1rem;">로그아웃</button>
                    </form>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="admin-panel">
        <div class="container">
            <!-- Header -->
            <div class="admin-header">
                <h1 style="font-size: 3rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    프로젝트 관리
                </h1>
            </div>

            <!-- Form Section -->
            <div class="admin-form">
                <h2 style="font-size: 1.75rem; margin-bottom: 1.5rem;"
                    th:text="${newProject.id == null ? '새 프로젝트 추가' : '프로젝트 수정'}">
                    새 프로젝트 추가
                </h2>

                <!-- Error Message -->
                <div th:if="${error}" class="error-message">
                    <p th:text="${error}"></p>
                </div>

                <!-- Project Form -->
                <form th:action="@{/admin/save}" th:object="${newProject}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <!-- Project ID (only for new projects) -->
                    <div class="form-group" th:if="${newProject.id == null or newProject.id == ''}">
                        <label for="projectId">프로젝트 ID *</label>
                        <input type="text" id="projectId" th:field="*{id}" required placeholder="예: theme-gallery">
                        <small style="color: var(--color-text-muted); font-size: 0.875rem;">
                            URL에 사용될 고유 ID입니다. (영문, 숫자, 하이픈만 사용)
                        </small>
                    </div>
                    <input th:if="${newProject.id != null and newProject.id != ''}" type="hidden" th:field="*{id}" />

                    <!-- Title -->
                    <div class="form-group">
                        <label for="title">제목 *</label>
                        <input type="text" id="title" th:field="*{title}" required placeholder="프로젝트 제목">
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label for="description">간략 설명 *</label>
                        <input type="text" id="description" th:field="*{description}" required placeholder="프로젝트에 대한 간단한 설명">
                    </div>

                    <!-- Git URL -->
                    <div class="form-group">
                        <label for="gitUrl">Git URL</label>
                        <input type="url" id="gitUrl" th:field="*{gitUrl}" placeholder="https://github.com/username/repo">
                    </div>

                    <!-- Live URL -->
                    <div class="form-group">
                        <label for="liveUrl">Live URL</label>
                        <input type="url" id="liveUrl" th:field="*{liveUrl}" placeholder="https://your-project.vercel.app">
                    </div>

                    <!-- Tech Stack -->
                    <div class="form-group">
                        <label for="stack">기술 스택 (쉼표로 구분)</label>
                        <input type="text" id="stack"
                               th:value="${newProject.stack != null ? #strings.arrayJoin(newProject.stack, ', ') : ''}"
                               name="stackString"
                               placeholder="React 18, TypeScript, Tailwind CSS">
                        <small style="color: var(--color-text-muted); font-size: 0.875rem;">
                            예: React 18, TypeScript, Tailwind CSS
                        </small>
                    </div>

                    <!-- Details (Markdown) -->
                    <div class="form-group">
                        <label for="details">상세 설명 (마크다운)</label>
                        <textarea id="details" th:field="*{details}" rows="12"
                                  placeholder="# 프로젝트 제목&#10;&#10;## 주요 기능&#10;- 기능 1&#10;- 기능 2"></textarea>
                        <small style="color: var(--color-text-muted); font-size: 0.875rem;">
                            마크다운 문법을 사용할 수 있습니다 (# 제목, ## 부제목, - 리스트 등)
                        </small>
                    </div>

                    <!-- Form Actions -->
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary"
                                th:text="${newProject.id == null ? '프로젝트 추가' : '변경사항 저장'}">
                            프로젝트 추가
                        </button>
                        <a th:if="${newProject.id != null}" href="/admin" class="btn btn-secondary">취소</a>
                    </div>
                </form>
            </div>

            <!-- Projects List -->
            <div style="margin-top: 4rem;">
                <h2 style="font-size: 2rem; margin-bottom: 2rem; color: var(--color-text-primary);">
                    현재 프로젝트 목록
                </h2>

                <!-- Empty State -->
                <div th:if="${#lists.isEmpty(projects)}" style="text-align: center; padding: 3rem; background: var(--color-bg-card); border-radius: 16px; border: 1px solid rgba(0, 212, 255, 0.1);">
                    <p style="color: var(--color-text-secondary); font-size: 1.125rem;">
                        등록된 프로젝트가 없습니다.
                    </p>
                </div>

                <!-- Projects Table -->
                <div th:unless="${#lists.isEmpty(projects)}" class="admin-table">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 15%;">ID</th>
                                <th style="width: 30%;">제목</th>
                                <th style="width: 35%;">간략 설명</th>
                                <th style="width: 20%;">액션</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="project : ${projects}">
                                <td th:text="${project.id}" style="font-family: 'Courier New', monospace;">project-id</td>
                                <td th:text="${project.title}">프로젝트 제목</td>
                                <td th:text="${project.description}">프로젝트 설명</td>
                                <td class="actions">
                                    <a th:href="@{/admin/edit/{id}(id=${project.id})}"
                                       class="btn btn-edit"
                                       style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                                        수정
                                    </a>
                                    <form th:action="@{/admin/delete/{id}(id=${project.id})}"
                                          method="post"
                                          style="display: inline;">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                        <button type="submit"
                                                class="btn btn-delete"
                                                style="padding: 0.5rem 1rem; font-size: 0.875rem;"
                                                onclick="return confirm('정말로 이 프로젝트를 삭제하시겠습니까?');">
                                            삭제
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Developer Portfolio. All Rights Reserved.</p>
        </div>
    </footer>

</body>
</html>
